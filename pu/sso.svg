<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1714px" preserveAspectRatio="none" style="width:1392px;height:1714px;" version="1.1" viewBox="0 0 1392 1714" width="1392px" zoomAndPan="magnify"><defs><filter height="300%" id="f1gpcowt9cxn1c" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1gpcowt9cxn1c)" height="1522.3906" style="stroke:#A80036;stroke-width:1.0;" width="10" x="33.5" y="98.2969"/><rect fill="#FFFFFF" filter="url(#f1gpcowt9cxn1c)" height="1486.125" style="stroke:#A80036;stroke-width:1.0;" width="10" x="300.5" y="134.5625"/><rect fill="#FFFFFF" filter="url(#f1gpcowt9cxn1c)" height="906.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="682.5" y="379.625"/><rect fill="#FFFFFF" filter="url(#f1gpcowt9cxn1c)" height="610.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1005.5" y="791.2891"/><rect fill="#FFFFFF" filter="url(#f1gpcowt9cxn1c)" height="59.2656" style="stroke:#000000;stroke-width:2.0;" width="288.5" x="163" y="188.6953"/><rect fill="#FFFFFF" filter="url(#f1gpcowt9cxn1c)" height="89.5313" style="stroke:#000000;stroke-width:2.0;" width="419.5" x="163" y="261.9609"/><rect fill="#FFFFFF" filter="url(#f1gpcowt9cxn1c)" height="161.6016" style="stroke:#000000;stroke-width:2.0;" width="419.5" x="163" y="481.0234"/><rect fill="#FFFFFF" height="87.2031" style="stroke:none;stroke-width:1.0;" width="419.5" x="163" y="555.4219"/><rect fill="#FFFFFF" filter="url(#f1gpcowt9cxn1c)" height="425.7344" style="stroke:#000000;stroke-width:2.0;" width="1225.5" x="153" y="695.7578"/><rect fill="#FFFFFF" height="220.6719" style="stroke:none;stroke-width:1.0;" width="1225.5" x="153" y="900.8203"/><rect fill="#FFFFFF" filter="url(#f1gpcowt9cxn1c)" height="191.8672" style="stroke:#000000;stroke-width:2.0;" width="555" x="163" y="922.625"/><rect fill="#FFFFFF" height="87.2031" style="stroke:none;stroke-width:1.0;" width="555" x="163" y="1027.2891"/><rect fill="#FFFFFF" filter="url(#f1gpcowt9cxn1c)" height="439.0625" style="stroke:#000000;stroke-width:2.0;" width="1305.5" x="10" y="1174.625"/><rect fill="#FFFFFF" height="146.6016" style="stroke:none;stroke-width:1.0;" width="1305.5" x="10" y="1467.0859"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="38" x2="38" y1="88.2969" y2="1630.6875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="305" x2="305" y1="88.2969" y2="1630.6875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="687.5" x2="687.5" y1="88.2969" y2="1630.6875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1010.5" x2="1010.5" y1="88.2969" y2="1630.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="20" y="84.9951">user</text><ellipse cx="38.5" cy="15" fill="#FEFECE" filter="url(#f1gpcowt9cxn1c)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M38.5,23 L38.5,50 M25.5,31 L51.5,31 M38.5,50 L25.5,65 M38.5,50 L51.5,65 " fill="none" filter="url(#f1gpcowt9cxn1c)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="20" y="1642.6826">user</text><ellipse cx="38.5" cy="1655.9844" fill="#FEFECE" filter="url(#f1gpcowt9cxn1c)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M38.5,1663.9844 L38.5,1690.9844 M25.5,1671.9844 L51.5,1671.9844 M38.5,1690.9844 L25.5,1705.9844 M38.5,1690.9844 L51.5,1705.9844 " fill="none" filter="url(#f1gpcowt9cxn1c)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#f1gpcowt9cxn1c)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="261" x="173" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="247" x="180" y="72.9951">sso_client_test_a.cloud_building.fun</text><rect fill="#FEFECE" filter="url(#f1gpcowt9cxn1c)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="261" x="173" y="1629.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="247" x="180" y="1649.6826">sso_client_test_a.cloud_building.fun</text><rect fill="#FEFECE" filter="url(#f1gpcowt9cxn1c)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="286" x="542.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="272" x="549.5" y="72.9951">sso_client_test_a.cloud_building.fun/api</text><rect fill="#FEFECE" filter="url(#f1gpcowt9cxn1c)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="286" x="542.5" y="1629.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="272" x="549.5" y="1649.6826">sso_client_test_a.cloud_building.fun/api</text><rect fill="#FEFECE" filter="url(#f1gpcowt9cxn1c)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="168" x="924.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="931.5" y="72.9951">sso.cloud_building.fun</text><rect fill="#FEFECE" filter="url(#f1gpcowt9cxn1c)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="168" x="924.5" y="1629.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="931.5" y="1649.6826">sso.cloud_building.fun</text><rect fill="#FFFFFF" filter="url(#f1gpcowt9cxn1c)" height="1522.3906" style="stroke:#A80036;stroke-width:1.0;" width="10" x="33.5" y="98.2969"/><rect fill="#FFFFFF" filter="url(#f1gpcowt9cxn1c)" height="1486.125" style="stroke:#A80036;stroke-width:1.0;" width="10" x="300.5" y="134.5625"/><rect fill="#FFFFFF" filter="url(#f1gpcowt9cxn1c)" height="906.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="682.5" y="379.625"/><rect fill="#FFFFFF" filter="url(#f1gpcowt9cxn1c)" height="610.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1005.5" y="791.2891"/><polygon fill="#A80036" points="288.5,130.5625,298.5,134.5625,288.5,138.5625,292.5,134.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="43.5" x2="294.5" y1="134.5625" y2="134.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="50.5" y="114.3638">访问前台某个授权 url 页面</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="50.5" y="129.4966">(sso_client_test_a.cloud_building.fun)</text><path d="M315,147.5625 L315,172.5625 L464,172.5625 L464,157.5625 L454,147.5625 L315,147.5625 " fill="#FBFB77" filter="url(#f1gpcowt9cxn1c)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M454,147.5625 L454,157.5625 L464,157.5625 L454,147.5625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="321" y="164.6294">请求授权 url 页面流程</text><path d="M163,188.6953 L223,188.6953 L223,195.6953 L213,205.6953 L163,205.6953 L163,188.6953 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="59.2656" style="stroke:#000000;stroke-width:2.0;" width="288.5" x="163" y="188.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10" x="178" y="201.7622">if</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="238" y="200.9058">[hash:jwtKey]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="310.5" x2="352.5" y1="226.9609" y2="226.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352.5" x2="352.5" y1="226.9609" y2="239.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="311.5" x2="352.5" y1="239.9609" y2="239.9609"/><polygon fill="#A80036" points="321.5,235.9609,311.5,239.9609,321.5,243.9609,317.5,239.9609" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="317.5" y="221.895">保存全局变量 jwtKey</text><path d="M163,261.9609 L223,261.9609 L223,268.9609 L213,278.9609 L163,278.9609 L163,261.9609 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="89.5313" style="stroke:#000000;stroke-width:2.0;" width="419.5" x="163" y="261.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10" x="178" y="275.0278">if</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="238" y="274.1714">[没有 jwtKey]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="310.5" x2="352.5" y1="330.4922" y2="330.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352.5" x2="352.5" y1="330.4922" y2="343.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="311.5" x2="352.5" y1="343.4922" y2="343.4922"/><polygon fill="#A80036" points="321.5,339.4922,311.5,343.4922,321.5,347.4922,317.5,343.4922" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="317.5" y="295.1606">携带 hash:redirect=授权 url 跳转到登录页</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="317.5" y="310.2935">转&lt;渲染 login 页面流程&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="317.5" y="325.4263">end</text><polygon fill="#A80036" points="670.5,375.625,680.5,379.625,670.5,383.625,674.5,379.625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="310.5" x2="676.5" y1="379.625" y2="379.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="317.5" y="374.5591">在请求头 Header 中带 jwtKey 调用后台业务接口</text><line style="stroke:#A80036;stroke-width:1.0;" x1="692.5" x2="734.5" y1="423.8906" y2="423.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="734.5" x2="734.5" y1="423.8906" y2="436.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="693.5" x2="734.5" y1="436.8906" y2="436.8906"/><polygon fill="#A80036" points="703.5,432.8906,693.5,436.8906,703.5,440.8906,699.5,436.8906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="699.5" y="403.6919">jwtKey 认证</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="299" x="699.5" y="418.8247">如果认证成功返回数据，如果失败返回错误码及原因</text><polygon fill="#A80036" points="321.5,462.0234,311.5,466.0234,321.5,470.0234,317.5,466.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="315.5" x2="681.5" y1="466.0234" y2="466.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="327.5" y="460.9575">返回结果</text><path d="M163,481.0234 L223,481.0234 L223,488.0234 L213,498.0234 L163,498.0234 L163,481.0234 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="161.6016" style="stroke:#000000;stroke-width:2.0;" width="419.5" x="163" y="481.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10" x="178" y="494.0903">if</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="54" x="238" y="493.2339">[认证成功]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="310.5" x2="352.5" y1="534.4219" y2="534.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352.5" x2="352.5" y1="534.4219" y2="547.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="311.5" x2="352.5" y1="547.4219" y2="547.4219"/><polygon fill="#A80036" points="321.5,543.4219,311.5,547.4219,321.5,551.4219,317.5,547.4219" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="317.5" y="514.2231">将数据渲染到页面展示给用户</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="317.5" y="529.356">结束</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="163" x2="582.5" y1="556.4219" y2="556.4219"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="54" x="168" y="566.6323">[认证失败]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="310.5" x2="352.5" y1="621.625" y2="621.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352.5" x2="352.5" y1="621.625" y2="634.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="311.5" x2="352.5" y1="634.625" y2="634.625"/><polygon fill="#A80036" points="321.5,630.625,311.5,634.625,321.5,638.625,317.5,634.625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="317.5" y="586.2935">携带 hash:redirect=授权 url 跳转到登录页</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="317.5" y="601.4263">转&lt;渲染 login 页面流程&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="317.5" y="616.5591">end</text><path d="M315,654.625 L315,679.625 L452,679.625 L452,664.625 L442,654.625 L315,654.625 " fill="#FBFB77" filter="url(#f1gpcowt9cxn1c)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M442,654.625 L442,664.625 L452,664.625 L442,654.625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="321" y="671.6919">渲染 login 页面流程</text><path d="M153,695.7578 L213,695.7578 L213,702.7578 L203,712.7578 L153,712.7578 L153,695.7578 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="425.7344" style="stroke:#000000;stroke-width:2.0;" width="1225.5" x="153" y="695.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10" x="168" y="708.8247">if</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="242" x="228" y="707.9683">[hash:redirect || 没有参数(直接进登录页面)]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="310.5" x2="352.5" y1="749.1563" y2="749.1563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352.5" x2="352.5" y1="749.1563" y2="762.1563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="311.5" x2="352.5" y1="762.1563" y2="762.1563"/><polygon fill="#A80036" points="321.5,758.1563,311.5,762.1563,321.5,766.1563,317.5,762.1563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="317.5" y="728.9575">redirect = hash:redirect || 首页</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="317.5" y="744.0903">将 redirect:授权 url 保存到 localStorage</text><polygon fill="#A80036" points="993.5,787.2891,1003.5,791.2891,993.5,795.2891,997.5,791.2891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="310.5" x2="999.5" y1="791.2891" y2="791.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="429" x="317.5" y="786.2231">携带 hash:redirect=登录 url 302 重定向到 sso.cloud_building.fun 前台</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1015.5" x2="1057.5" y1="820.4219" y2="820.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1057.5" x2="1057.5" y1="820.4219" y2="833.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1016.5" x2="1057.5" y1="833.4219" y2="833.4219"/><polygon fill="#A80036" points="1026.5,829.4219,1016.5,833.4219,1026.5,837.4219,1022.5,833.4219" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="344" x="1022.5" y="815.356">从 localStorage 获取 usermap = { username: jwtKey }</text><polygon fill="#A80036" points="321.5,888.8203,311.5,892.8203,321.5,896.8203,317.5,892.8203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="315.5" x2="1004.5" y1="892.8203" y2="892.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="501" x="327.5" y="857.4888">携带 hash:usermap 301 跳转回 sso_client_test_a.cloud_building.fun 登录url 页面</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="327.5" y="872.6216">转&lt;渲染 login 页面流程&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="327.5" y="887.7544">end</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="153" x2="1378.5" y1="901.8203" y2="901.8203"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="158" y="912.0308">[hash:usermap]</text><path d="M163,922.625 L223,922.625 L223,929.625 L213,939.625 L163,939.625 L163,922.625 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="191.8672" style="stroke:#000000;stroke-width:2.0;" width="555" x="163" y="922.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10" x="178" y="935.6919">if</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="475" x="238" y="934.8354">[从 localStorage 获取 username &amp;&amp; 从 usermap 中拿到了 username 的 jwtKey]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="310.5" x2="352.5" y1="1006.2891" y2="1006.2891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352.5" x2="352.5" y1="1006.2891" y2="1019.2891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="311.5" x2="352.5" y1="1019.2891" y2="1019.2891"/><polygon fill="#A80036" points="321.5,1015.2891,311.5,1019.2891,321.5,1023.2891,317.5,1019.2891" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="317.5" y="955.8247">保存全局变量 jwtKey</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="317.5" y="970.9575">从 localStorage 获取 redirect:授权 url</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="317.5" y="986.0903">转&lt;请求授权 url 页面流程&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="317.5" y="1001.2231">end</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="163" x2="718" y1="1028.2891" y2="1028.2891"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="168" y="1038.4995">[拿不到 jwtKey]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="310.5" x2="352.5" y1="1093.4922" y2="1093.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352.5" x2="352.5" y1="1093.4922" y2="1106.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="311.5" x2="352.5" y1="1106.4922" y2="1106.4922"/><polygon fill="#A80036" points="321.5,1102.4922,311.5,1106.4922,321.5,1110.4922,317.5,1106.4922" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="358" x="317.5" y="1058.1606">解析 usermap 转换为用户列表, 渲染 login 页面等待用户输入</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="317.5" y="1073.2935">转&lt;用户登录流程&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="317.5" y="1088.4263">end</text><path d="M48,1133.4922 L48,1158.4922 L147,1158.4922 L147,1143.4922 L137,1133.4922 L48,1133.4922 " fill="#FBFB77" filter="url(#f1gpcowt9cxn1c)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M137,1133.4922 L137,1143.4922 L147,1143.4922 L137,1133.4922 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="54" y="1150.5591">用户登录流程</text><path d="M10,1174.625 L70,1174.625 L70,1181.625 L60,1191.625 L10,1191.625 L10,1174.625 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="439.0625" style="stroke:#000000;stroke-width:2.0;" width="1305.5" x="10" y="1174.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10" x="25" y="1187.6919">if</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="85" y="1186.8354">[输入用户名和密码]</text><polygon fill="#A80036" points="288.5,1208.8906,298.5,1212.8906,288.5,1216.8906,292.5,1212.8906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="43.5" x2="294.5" y1="1212.8906" y2="1212.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="50.5" y="1207.8247">输入用户名和密码</text><polygon fill="#A80036" points="670.5,1238.0234,680.5,1242.0234,670.5,1246.0234,674.5,1242.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="310.5" x2="676.5" y1="1242.0234" y2="1242.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="317.5" y="1236.9575">请求后台登录接口</text><polygon fill="#A80036" points="321.5,1282.2891,311.5,1286.2891,321.5,1290.2891,317.5,1286.2891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="315.5" x2="686.5" y1="1286.2891" y2="1286.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="327.5" y="1266.0903">登录成功返回 jwtKey</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="207" x="327.5" y="1281.2231">将 username 保存到 localstorage</text><polygon fill="#A80036" points="993.5,1326.5547,1003.5,1330.5547,993.5,1334.5547,997.5,1330.5547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="310.5" x2="999.5" y1="1330.5547" y2="1330.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="343" x="317.5" y="1310.356">从 localStorage 获取 redirect:授权 url, 组装 hash:jwtKey</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="566" x="317.5" y="1325.4888">携带组装了 hash 的授权 url, { username, jwtKey } 302 重定向到 sso.cloud_building.fun 前台</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1015.5" x2="1057.5" y1="1359.6875" y2="1359.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1057.5" x2="1057.5" y1="1359.6875" y2="1372.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1016.5" x2="1057.5" y1="1372.6875" y2="1372.6875"/><polygon fill="#A80036" points="1026.5,1368.6875,1016.5,1372.6875,1026.5,1376.6875,1022.5,1372.6875" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="1022.5" y="1354.6216">将 { username, jwtKey } 保存到 localStorage</text><polygon fill="#A80036" points="321.5,1397.8203,311.5,1401.8203,321.5,1405.8203,317.5,1401.8203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="315.5" x2="1009.5" y1="1401.8203" y2="1401.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="423" x="327.5" y="1396.7544">携带 jwtKey 301 跳转回 sso_client_test_a.cloud_building.fun 授权 url</text><line style="stroke:#A80036;stroke-width:1.0;" x1="310.5" x2="352.5" y1="1446.0859" y2="1446.0859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352.5" x2="352.5" y1="1446.0859" y2="1459.0859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="311.5" x2="352.5" y1="1459.0859" y2="1459.0859"/><polygon fill="#A80036" points="321.5,1455.0859,311.5,1459.0859,321.5,1463.0859,317.5,1459.0859" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="317.5" y="1425.8872">转&lt;请求授权 url 页面流程&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="317.5" y="1441.02">end</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1315.5" y1="1468.0859" y2="1468.0859"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="161" x="15" y="1478.2964">[选择用户列表中的username]</text><polygon fill="#A80036" points="288.5,1499.0234,298.5,1503.0234,288.5,1507.0234,292.5,1503.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="43.5" x2="294.5" y1="1503.0234" y2="1503.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="50.5" y="1497.9575">选择用户列表中的username</text><line style="stroke:#A80036;stroke-width:1.0;" x1="310.5" x2="352.5" y1="1592.6875" y2="1592.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352.5" x2="352.5" y1="1592.6875" y2="1605.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="311.5" x2="352.5" y1="1605.6875" y2="1605.6875"/><polygon fill="#A80036" points="321.5,1601.6875,311.5,1605.6875,321.5,1609.6875,317.5,1605.6875" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="317.5" y="1527.0903">拿到了 username 的 jwtKey</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="317.5" y="1542.2231">保存全局变量 jwtKey</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="317.5" y="1557.356">从 localStorage 获取 redirect:授权 url</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="317.5" y="1572.4888">转&lt;请求授权 url 页面流程&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="317.5" y="1587.6216">end</text><!--MD5=[098cb5b70d412b32a826cb4af054c249]
@startuml sso
actor                        user
participant "sso_client_test_a.cloud_building.fun" as       webA
participant "sso_client_test_a.cloud_building.fun/api" as   sevA
participant "sso.cloud_building.fun" as     webS

activate user
user -> webA: 访问前台某个授权 url 页面\n(sso_client_test_a.cloud_building.fun)

note right of webA: 请求授权 url 页面流程
group if [hash:jwtKey]
  activate webA
  webA -> webA: 保存全局变量 jwtKey
end

group if [没有 jwtKey]
  webA -> webA: 携带 hash:redirect=授权 url 跳转到登录页\n转<渲染 login 页面流程>\nend
end

webA -> sevA: 在请求头 Header 中带 jwtKey 调用后台业务接口

activate sevA
sevA -> sevA: jwtKey 认证\n如果认证成功返回数据，如果失败返回错误码及原因
sevA - -> webA: 返回结果

group if [认证成功]
  webA -> webA: 将数据渲染到页面展示给用户\n结束
else 认证失败
  webA -> webA: 携带 hash:redirect=授权 url 跳转到登录页\n转<渲染 login 页面流程>\nend
end

note right of webA: 渲染 login 页面流程

group if [hash:redirect || 没有参数(直接进登录页面)]
  webA -> webA: redirect = hash:redirect || 首页\n将 redirect:授权 url 保存到 localStorage
  webA -> webS: 携带 hash:redirect=登录 url 302 重定向到 sso.cloud_building.fun 前台
  
  activate webS
  webS -> webS: 从 localStorage 获取 usermap = { username: jwtKey }
  webS - -> webA: 携带 hash:usermap 301 跳转回 sso_client_test_a.cloud_building.fun 登录url 页面\n转<渲染 login 页面流程>\nend
else hash:usermap
  group if [从 localStorage 获取 username && 从 usermap 中拿到了 username 的 jwtKey]
    webA -> webA: 保存全局变量 jwtKey\n从 localStorage 获取 redirect:授权 url\n转<请求授权 url 页面流程>\nend
  else 拿不到 jwtKey
    webA -> webA: 解析 usermap 转换为用户列表, 渲染 login 页面等待用户输入\n转<用户登录流程>\nend
  end
end

note right of user: 用户登录流程

group if [输入用户名和密码]
  user -> webA: 输入用户名和密码
  webA -> sevA: 请求后台登录接口
  sevA - -> webA: 登录成功返回 jwtKey\n将 username 保存到 localstorage
  deactivate sevA

  webA -> webS: 从 localStorage 获取 redirect:授权 url, 组装 hash:jwtKey\n携带组装了 hash 的授权 url, { username, jwtKey } 302 重定向到 sso.cloud_building.fun 前台
  webS -> webS: 将 { username, jwtKey } 保存到 localStorage
  webS - -> webA: 携带 jwtKey 301 跳转回 sso_client_test_a.cloud_building.fun 授权 url
  deactivate webS

  webA -> webA: 转<请求授权 url 页面流程>\nend
else 选择用户列表中的username
  user -> webA: 选择用户列表中的username
  webA -> webA: 拿到了 username 的 jwtKey\n保存全局变量 jwtKey\n从 localStorage 获取 redirect:授权 url\n转<请求授权 url 页面流程>\nend
end

deactivate webA
deactivate user
@enduml

PlantUML version 1.2020.22(Sun Dec 06 09:36:27 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>